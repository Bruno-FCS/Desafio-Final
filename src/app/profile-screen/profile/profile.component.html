<nav class="navbar">
  <img
    src="../../../assets/img/menu-icon.png"
    class="left-icon position-relative"
    (click)="menu.abrirMenu()"
    (keyup.space)="menu.abrirMenu()"
  />

  <img
    class="img-settings"
    src="../../../assets/img/ford.png"
    alt="Logo da Ford"
  />

  <img
    src="../../../assets/img/user-icon.png"
    class="right-icon position-relative"
    (click)="settings.abrirSettings()"
    (keyup.space)="settings.abrirSettings()"
  />
</nav>

<div class="container">
  <h2 class="mt-4 text-color row justify-content-center">Meu perfil</h2>
  <div class="d-flex row">
    <div class="col-6">
      <form
        class="mt-5 form"
        [formGroup]="updateForm"
        (ngSubmit)="update()"
        *ngIf="usuario$ | async as usuario"
      >
        <input
          class="form-control"
          formControlName="user_id"
          type="text"
          [(ngModel)]="usuario.user_id"
          readonly
          hidden
        />

        <div class="form-group mb-3 input-container m-auto">
          <div class="input-field">Usuário:</div>
          <div class="input-field">
            <input
              class="form-control"
              formControlName="user_name"
              type="text"
              [(ngModel)]="usuario.user_name"
            />
          </div>
          <app-mensagem
            *ngIf="
        updateForm.get('user_name')?.errors?.['required'] &&
        updateForm.get('user_name')?.touched
      "
            mensagem="Campo usuário obrigatório"
          ></app-mensagem>
          <app-mensagem
            *ngIf="
            updateForm.get('user_name')?.errors?.['minlength'] &&
            updateForm.get('user_name')?.touched
      "
            mensagem="Campo usuário deve ter ao menos 5 caracteres"
          ></app-mensagem>
        </div>

        <div class="form-group mb-3 input-container m-auto">
          <div class="input-field">Nome completo:</div>
          <div class="input-field">
            <input
              class="form-control"
              formControlName="user_full_name"
              type="text"
              [(ngModel)]="usuario.user_full_name"
            />
          </div>
          <app-mensagem
            *ngIf="
              updateForm.get('user_full_name')?.errors &&
              updateForm.get('user_full_name')?.touched
            "
            mensagem="Campo nome completo obrigatório"
          ></app-mensagem>
        </div>

        <div class="form-group mb-4 input-container m-auto">
          <div class="input-field">E-mail:</div>
          <div class="input-field">
            <input
              class="form-control"
              formControlName="user_email"
              type="text"
              [(ngModel)]="usuario.user_email"
            />
          </div>
          <app-mensagem
            *ngIf="
          updateForm.get('user_email')?.errors?.['required'] &&
          updateForm.get('user_email')?.touched
        "
            mensagem="Campo e-mail obrigatório"
          ></app-mensagem>
          <app-mensagem
            *ngIf="
          updateForm.get('user_email')?.errors?.['email'] &&
          updateForm.get('user_email')?.touched
        "
            mensagem="E-mail inválido"
          ></app-mensagem>
        </div>

        <div class="d-flex justify-content-center">
          <button class="btn btn-secondary" [disabled]="updateForm.invalid">
            Atualizar dados
          </button>
        </div>
      </form>
    </div>

    <div class="col-6">
      <form
        class="mt-5 form"
        [formGroup]="passwordForm"
        (ngSubmit)="changePassword()"
        *ngIf="usuario$ | async as usuario"
      >
        <input
          class="form-control"
          formControlName="user_id"
          type="text"
          [(ngModel)]="usuario.user_id"
          readonly
          hidden
        />

        <div class="form-group mb-3 input-container m-auto">
          <div class="input-field">Senha atual:</div>
          <div class="input-field">
            <input
              class="form-control"
              formControlName="user_former_password"
              type="password"
            />
          </div>
          <app-mensagem
            *ngIf="
        passwordForm.get('user_former_password')?.errors?.['required'] &&
        passwordForm.get('user_former_password')?.touched
      "
            mensagem="Campo senha obrigatório"
          ></app-mensagem>
          <app-mensagem
            *ngIf="
        passwordForm.get('user_former_password')?.errors?.['minlength'] &&
        passwordForm.get('user_former_password')?.touched
      "
            mensagem="Campo senha deve ter ao menos 6 caracteres"
          ></app-mensagem>
        </div>

        <div class="form-group mb-3 input-container m-auto">
          <div class="input-field">Nova senha:</div>
          <div class="input-field">
            <input
              class="form-control"
              type="password"
              formControlName="user_password"
            />
          </div>
          <app-mensagem
            *ngIf="
        passwordForm.get('user_password')?.errors?.['required'] &&
        passwordForm.get('user_password')?.touched
      "
            mensagem="Campo senha obrigatório"
          ></app-mensagem>
          <app-mensagem
            *ngIf="
        passwordForm.get('user_password')?.errors?.['minlength'] &&
        passwordForm.get('user_password')?.touched
      "
            mensagem="Campo senha deve ter ao menos 6 caracteres"
          ></app-mensagem>
        </div>

        <div class="form-group mb-4 input-container m-auto">
          <div class="input-field">Confirmar nova senha:</div>
          <div class="input-field">
            <input
              class="form-control"
              formControlName="user_password_confirm"
              type="password"
            />
          </div>
          <app-mensagem
            *ngIf="
        passwordForm.get('user_password_confirm')?.errors?.['equalsTo']
      "
            mensagem="Senhas não coincidem"
          ></app-mensagem>
        </div>

        <div class="d-flex justify-content-center">
          <button class="btn btn-secondary" [disabled]="updateForm.invalid">
            Alterar senha
          </button>
        </div>
      </form>
    </div>
  </div>

  <app-menu #menu></app-menu>
  <app-settings #settings></app-settings>
</div>
